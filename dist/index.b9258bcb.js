let e;var t;(t=e||(e={}))[t.div=0]="div",t[t.mul=1]="mul",t[t.sub=2]="sub",t[t.add=3]="add",t[t.eq=4]="eq",t[t.negate=5]="negate",t[t.percent=6]="percent";class s{value="0";shouldAppendDecimal=!1;isDisplayingResult=!1;continueOperation=!1;get stringValue(){const e=this.value??this.register,t=parseFloat(e);return t>999999999||t<-99999999||0!==t&&Math.abs(t)<1e-6?"Err":e}appendDigit(e){(void 0!==this.selectedOperation&&void 0===this.register||this.isDisplayingResult)&&(this.register=this.value,this.value=void 0,this.isDisplayingResult=!1),void 0===this.value?this.value=e.toString():this.value.length<9&&"Err"!==this.value&&("0"===this.value?this.value=e.toString():this.value+=e.toString()),this.view.modelDidUpdate(this)}appendDecimal(){void 0!==this.selectedOperation&&void 0===this.register||this.isDisplayingResult?(this.register=this.value,this.value="0.",this.isDisplayingResult=!1):void 0===this.value?this.value="0.":this.value.includes(".")||(this.value+="."),this.view.modelDidUpdate(this)}didSelectOperator(t){switch(t){case e.div:case e.mul:case e.sub:case e.add:void 0===this.register||this.selectedOperation!==t||this.continueOperation?this.selectOperation(t):this.performBinaryOperation(t);break;case e.eq:void 0!==this.selectedOperation&&(void 0===this.register?this.register=this.value:void 0===this.value&&(this.value=this.register),this.performBinaryOperation(this.selectedOperation)),this.isDisplayingResult=!0;break;default:void 0===this.value&&(this.value=this.register),this.register=void 0,this.performUnaryOperation(t)}this.view.modelDidUpdate(this)}clear(){this.value="0",this.register=void 0,this.selectedOperation=void 0,this.shouldAppendDecimal=!1,this.view.modelDidUpdate(this)}selectOperation(e){this.selectedOperation=e,this.isDisplayingResult=!0,this.continueOperation=!1}performBinaryOperation(t){let s=parseFloat(this.value),i=parseFloat(this.register);switch(t){case e.div:s=this.continueOperation?s/i:i/s;break;case e.mul:s*=i;break;case e.sub:s=this.continueOperation?s-i:i-s;break;case e.add:s=i+s}this.isDisplayingResult=!0,this.continueOperation||(this.register=this.value,this.continueOperation=!0),this.value=this.valueToString(s)}performUnaryOperation(t){let s=parseFloat(this.value);switch(t){case e.negate:s=-s;break;case e.percent:s/=100}this.value=this.valueToString(s)}valueToString(e){const t=Math.abs(e)<1?8:9;let s=e.toPrecision(t);return s.includes(".")&&(s=s.replace(/\.?0*$/,"")),s}}class i{constructor(e){this.controller=e,this.init()}init(){document.querySelectorAll(".calc-button").forEach((e=>{e.onclick=t=>this.handleButtonClicked(e)})),document.body.onkeydown=e=>this.handleKeyDown(e),document.body.onkeyup=e=>this.handleKeyUp(e)}handleKeyDown(e){document.activeElement instanceof HTMLElement&&document.activeElement.blur();const t=this.elemForKey(e);null!==t&&(t.classList.add("active"),this.handleButtonClicked(t))}handleKeyUp(e){document.querySelectorAll(".active").forEach((e=>{e.classList.remove("active")}))}elemForKey(e){switch(console.log(`${e.altKey?"Alt+":""}${e.key}`),e.key){case"Escape":return document.getElementById("clr");case"-":case"â€“":return e.altKey?document.getElementById("negate"):document.getElementById("sub");case"%":return document.getElementById("percent");case"/":return document.getElementById("div");case"*":return document.getElementById("mul");case"+":return document.getElementById("add");case"=":case"Enter":return document.getElementById("eq");default:return document.getElementById(e.key)}}handleButtonClicked(e){switch(e.getAttribute("calc-button-type")??e.parentElement?.getAttribute("calc-button-type")){case"num":const t=parseInt(e.innerText);this.controller.dispatch({type:"number_pressed",value:t});break;case"clr":this.controller.dispatch({type:"clear_pressed"});break;case"dec":this.controller.dispatch({type:"decimal_pressed"});break;case"op":const s=e.id;let i=this.parseOperator(s);this.controller.dispatch({type:"operator_pressed",operator:i})}}async modelDidUpdate(t){const s=document.getElementById("display");s.innerText="",await new Promise((e=>{setTimeout((()=>{e()}),80)}));if(document.querySelector(".calc-button-selected")?.classList.remove("calc-button-selected"),null!=t.selectedOperation)switch(t.selectedOperation){case e.div:document.getElementById("div")?.classList.add("calc-button-selected");break;case e.mul:document.getElementById("mul")?.classList.add("calc-button-selected");break;case e.sub:document.getElementById("sub")?.classList.add("calc-button-selected");break;case e.add:document.getElementById("add")?.classList.add("calc-button-selected")}s.innerText=t.stringValue}parseOperator(t){switch(t){case"negate":return e.negate;case"percent":return e.percent;case"div":return e.div;case"mul":return e.mul;case"sub":return e.sub;case"add":return e.add;default:return e.eq}}}class a{model=new s;view=new i(this);init(){this.model.view=this.view}dispatch(e){switch(e.type){case"number_pressed":this.model.appendDigit(e.value);break;case"clear_pressed":this.model.clear();break;case"decimal_pressed":this.model.appendDecimal();break;case"operator_pressed":this.model.didSelectOperator(e.operator)}}}(new a).init();
//# sourceMappingURL=index.b9258bcb.js.map
